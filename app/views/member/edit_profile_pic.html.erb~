<h3><%= title "Profile Picture" %></h3>

<%= form_for @member, :url => { :action => "update_profile_pic" }, :html => {:multipart => true,  :method => :put } do |f| %>
  <% if @member.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@member.errors.count, "error") %> prohibited this profile from being saved:</h2>

      <ul>
      <% @member.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<% if @profile_pics.count == 1 && @profile_pics[0].status == '1' %>
	<%= image_tag @profile_pics[0].photo.url %>
<% elsif @profile_pics.count > 1 %>
	<% pic = @profile_pics.find(:last, :conditions => 'status = 2') %>
	<%= image_tag pic.photo.url %>
<%end%>

  <%= f.fields_for :profile_pic do |builder| %>


	  <% if @profile_pics.empty?  %>
		  <%= builder.label :photo, 'Upload a Profile Picture' %>
		    <%= builder.file_field :photo %>
	  <% else %>

  <% if pic = @profile_pics.find(:first, :conditions => 'status = 1') %>
	  <p>Awaiting Confirmation:</p>
	  <%= image_tag pic.photo.url%>
	  <p>Once this photo has been verified, it will automatically replace your current profile photo. </p>
	  <%= link_to 'Cancel Verification Request', verification_cancel_path %>
  <% elsif pic = @profile_pics.find(:last,:conditions => 'status = 3')%>
		  <p> Your previous uploaded photo is invalid, please upload another one.</p>
		<%= image_tag pic.photo.url%>
	    <%= builder.label :photo, 'Change Photo' %>
  <%= builder.file_field :photo %>
<% else %>
    <%= builder.label :photo, 'Change Photo' %>
  <%= builder.file_field :photo %>

	<% end %>

  
    <% end %>
    
    <%= builder.hidden_field :status, :value => 1 %>
<% end %>


  <p><%= f.submit "Update"%></p>
  


<% end %>
